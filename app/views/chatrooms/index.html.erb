<%= provide(:turbolinks_cache, 'no-cache') %>

<div class="container boxes">
  <% @chatrooms.each do |chatroom| %>
    <div class="row justify-content-between">
      <div class= "col-6 card-deck teacher-card h-100">
        <div class="row no-gutters">
          <div class="col-md-3 image image-chatroom">
            <% if chatroom.teacher.photo.attached? %>
              <%= cl_image_tag chatroom.teacher.photo.key, crop: :fill, width: 180, height: 180, class: "teacher-avatar img-fluid" %>
            <% else %>
              <i class="fas fa-user-circle fa-2x avatar text-secondary" data-toggle="dropdown"></i>
            <% end %>
          </div>
          <div class="col-md-9">
            <div class="card-text pl-5 mt-3 ml-5">
              <h5><strong><%= "#{chatroom.teacher.user.first_name} #{chatroom.teacher.user.last_name}" %></strong></h5>
              <small><%= chatroom.created_at.strftime("%a %b %e at %l:%M%p") %></small>
              <br>
              <% if chatroom.messages.length > 0 %>
                <small><%= chatroom.messages.last.content %></small>
              <% else %>
                <small><%= "Send your first message!" %></small>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <div class="col-6 card-deck ninja-card">
        <span class="disabled"></span>
        <div class="col-md-12">
          <h6><strong><%= "#{chatroom.teacher.user.first_name} #{chatroom.teacher.user.last_name}"%></strong></h6>
          <div class="messages" data-chatroom-id="<%= chatroom.id %>">
            <% chatroom.messages.each do |message| %>
              <%= render "messages/message", message: message %>
            <% end %>
          </div>
          <div class="col-md-12">
            <%= simple_form_for [ chatroom, Message.new ], remote: true do |f| %>
              <%= f.input :content, label: false, placeholder: "Message #{chatroom.teacher.user.first_name} #{chatroom.teacher.user.last_name}" %>
              <%= f.submit "Send" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
